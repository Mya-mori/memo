[参考文献](https://www.oracle.com/jp/a/tech/docs/technical-resources/0420-1330-oracle-architecture.pdf)を読む

# Oracle Databaseの概要

## 内部構造
### 処理の仕組み
- クライアントはSQLでデータベースにアクセス処理を要求
- データベース時は要求に従い処理を実行
- 物理的データはストレージに格納

### コンポーネント
- インスタンス
  - サーバ上にあるメモリ＋プロセス(書き込みなどを行う)
- データベース
  - ストレージにあるデータ

### プロセスの種類
- リスナー・プロセス
  - データベースに接続リクエスト
- サーバープロセス
  - ユーザーごとに起動され、リクエストされた処理を実行
- バックグラウンド・プロセス
  - ディスクへの変更反映

### メモリの種類
- システム・グローバル領域(SGA)
  - 表データや実行計画をキャッシュ
  - ユーザー間で共有するディスクI/Oを減らす
    - ディスクI/O - ハードディスクなどの外部記憶装置（ストレージ）に対するデータの読み書き操作
- プログラム・グローバル領域(PGA)
  - プロセスごとに確保される領域

### データベース・ファイルの種類
- データ・ファイル
  - ユーザーが利用するデータ（表など）を格納
- 制御ファイル
  - データベース構造、変更反映状況などの制御情報を格納
- REDOログ・ファイル
  - 変更履歴（DML,DDLなど）を格納
    - DML（データ操作言語）
      - Data Manipulation Languageの略でデータを操作するSQL文（SELECT文など）
    - DDL（データ定義言語）
      - Data Definition Languageの略でデータを定義するSQL文（CREATE文など）

## 処理の仕組み
### 概要
1. クライアント側で接続するデータベース情報を設定ファイルに接続
2. 接続時、リスナー・プロセスを通じて、データベースに接続
    - リスナー・プロセス データベースへの接続リクエストを受け取るプロセス

### 実行(検索処理)
1. ユーザー側からSQLの発行
2. リスナー・プロセスを経由してサーバープロセスへ
3. 共有プールにてSQL解析及び実行計画を立てる
4. 3を実行時、データ・ディクショナリでオブジェクトやユーザーの情報を基に事前解析を行う
5. 読み込んだデータはメモリにキャッシュする

### 実行(更新処理)
1. 変更履歴をREDOログ・バッファに持たせる
2. 変更後のデータをデータベースに持たせる(変更前のデータもROLLBACKできるように持たせる)

### 実行(COMMIT)
1. COMMIT時、変更履歴はREDOログ・ファイルに持たせる
  - 障害復旧に使用する
2. 制御ファイル
  - 変更をいつファイルに変更したかを反映(チェックポイント)

### システム・グローバル領域(SGA)コンポーネント
- データベース・バッファ・キャッシュ
  - データベースから取得されたデータ・ブロック（表、索引など）をキャッシュする領域
- REDOログ・バッファ
  - ディスク（REDOログ・ファイル）に書き込むまでREDO情報を
キャッシュ（インスタンス・リカバリに使用）する領域
- 共有プール
  - 実行されたSQL文の解析に使うデータや実行計画、および
ユーザー間で共有できる様々な構造をキャッシュする領域

### SGA バックグラウンド・プロセスの詳細
- データベース・ライター（DBWR）
  - データベース・バッファ・キャッシュ上で更新されたデータを定期的にデータ・ファイルに書き込む
- ログ・ライター（LGWR）
  - REDOログ・バッファ上のREDOログ・エントリを定期的にREDO
ログ・ファイルに書き込む（COMMIT時など）
- チェックポイント（CKPT）
  - チェックポイント発生時に制御ファイルやデータ・ファイルのヘッダを更新し、同期をとる
- システム・モニター（SMON）
  - インスタンス障害後、再起動の際に自動的にインスタンス・リカバリを行う
- プロセス・モニター（PMON）
  - サーバ・プロセスの監視を行い、ユーザー・プロセス障害時にクリーンアップを行う（ロックの開放、ロールバックなど）

### プログラム・グローバル領域(PGA)
- セッション情報
  - ユーザー権限に関する情報
- カーソル状態
  - カーソルの処理状況
- スタック空間
  - セッション変数の格納
- ソート領域
  - ソート処理に使用

# Oracle Databaseの管理
## メモリの管理
- メモリ不足がパフォーマンスの劣化を導く
- 処理内容に応じて、必要なメモリを割り当てる

例)
- PGAで不足の場合
  - メモリ内でソート処理ができず、ディスク・ソートが発生する
  - ソート・結合の処理がおそくなる
- データベース・バッファ・キャッシュで不足の場合
  - キャッシュしたものをファイルに書き出し、次回アクセス時再度ディスクから読み取る
- 共有プールで不足
  - 読み込んだデータ・ディクショナリや実行計画が消去される
  - 何度も解析をしなければならない

## 領域の管理
- ファイル群
  - 制御ファイル
    - データベースの制御情報を格納
      - データベース名
      - REDOログ・ファイルおよびデータファイルの名前と場所、ステータス
      - チェックポイント情報（メモリ上の情報をいつ、どこまでファイルに反映したか等）
  - REDOログ・ファイル
    - 変更履歴（DML,DDLなど）を格納
      - 書き込みタイミング
        -  COMMIT時
        -  REDOログ・バッファが一杯になった場合
        -  データベース・ライターが書き込む前 など
    　 - 障害時の復旧に使用
  - データ・ファイル
    - ユーザーが利用するデータ（表など）を格納
